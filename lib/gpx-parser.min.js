var gpxParser=function(){this.xmlSource="",this.jsonSource="",this.trackpoints={},this.waypoints={},this.routepoints={},this.distance=0,this.cumulDistance=[],this.elevation={},this.deniv={}};gpxParser.prototype.parse=function(t){function e(t){var e={};if(t.querySelector("bounds")){for(var r=t.querySelector("bounds"),s=[],o=0;o<r.attributes.length;o++)s[r.attributes[o].name]=r.attributes[o].value;e.bounds=s}if(t.querySelector("time")&&(e.time=t.querySelector("time").innerHTML),t.querySelector("rte")){var i=t.querySelector("rte");e.rte={},e.rte.name=i.querySelector("name").innerHTML,e.rte.desc=i.querySelector("desc").innerHTML;for(var a=t.querySelectorAll("rtept"),n=[],o=0,l=a.length;l>o;o++){var h=[];h.lat=a[o].getAttribute("lat"),h.lon=a[o].getAttribute("lon");for(var c=0;c<a[o].childNodes.length;c++)h[a[o].childNodes[c].tagName]=a[o].childNodes[c].innerHTML;n.push(h)}e.rte.rtepts=n}if(t.querySelector("trk")){var p=t.querySelector("trk");e.trk={},p.querySelector("name")&&(e.trk.name=p.querySelector("name").innerHTML),p.querySelector("desc")&&(e.trk.desc=p.querySelector("desc").innerHTML);for(var u=t.querySelectorAll("trkpt"),y=[],o=0,l=u.length;l>o;o++){var h=[];h.lat=u[o].getAttribute("lat"),h.lon=u[o].getAttribute("lon");for(var c=0;c<u[o].childNodes.length;c++)h[u[o].childNodes[c].tagName]=u[o].childNodes[c].innerHTML;y.push(h)}e.trk.trkpts=y}if(t.querySelector("wpt")){for(var d=t.querySelectorAll("wpt"),v=[],o=0,l=d.length;l>o;o++){var h=[];h.lat=d[o].getAttribute("lat"),h.lon=d[o].getAttribute("lon");for(var c=0;c<d[o].childNodes.length;c++)h[d[o].childNodes[c].tagName]=d[o].childNodes[c].innerHTML;v.push(h)}e.wpt=v}return e}var r=(new DOMParser).parseFromString(t,"text/xml");this.xmlSource=r,this.jsonSource=e(r),void 0!=this.jsonSource.trk&&(this.trackpoints=this.jsonSource.trk.trkpts),void 0!=this.jsonSource.rte&&(this.routepoints=this.jsonSource.rte.rtepts),void 0!=this.jsonSource.wpt&&(this.waypoints=this.jsonSource.wpt),this.calcElevation(),this.calcTotalDistance(),console.log("Parse done !")},gpxParser.prototype.calcTotalDistance=function(){function t(t,e){var r=parseFloat(t.lat),s=parseFloat(t.lon),o=parseFloat(t.ele),i=parseFloat(e.lat),a=parseFloat(e.lon),n=parseFloat(e.ele),l=6366;r*=Math.PI/180,i*=Math.PI/180,s*=Math.PI/180,a*=Math.PI/180,o/=1e3,n/=1e3;var h=2*Math.asin(Math.sqrt(Math.pow(Math.sin((r-i)/2),2)+Math.cos(r)*Math.cos(i)*Math.pow(Math.sin((s-a)/2),2))),c=h*l,p=Math.sqrt(Math.pow(c,2)+Math.pow(n-o,2));return p}var e;this.isEmpty(this.trackpoints)?this.isEmpty(this.waypoints)?this.isEmpty(this.routepoints)||(e=this.routepoints):e=this.waypoints:e=this.trackpoints;var r=0;this.cumulDistance.push(0);for(var s=0;s<e.length-1;s++)r+=t(e[s],e[s+1]),this.cumulDistance.push(r);this.distance=r},gpxParser.prototype.calcElevation=function(){var t;this.isEmpty(this.trackpoints)?this.isEmpty(this.waypoints)?this.isEmpty(this.routepoints)||(t=this.routepoints):t=this.waypoints:t=this.trackpoints;for(var e=0,r=0,s={},o=0;o<t.length-1;o++){var i=parseFloat(t[o+1].ele["#text"])-parseFloat(t[o].ele["#text"]);0>i?r+=i:i>0&&(e+=i)}for(var a=[],o=0,n=t.length;n>o;o++)a.push(parseFloat(t[o].ele));this.elevation=a,s.max=Math.max.apply(null,a),s.min=Math.min.apply(null,a),s["d+"]=e,s["d-"]=r,this.deniv=s},gpxParser.prototype.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};
